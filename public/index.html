<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>The Threshing Floor</title>
  <meta name="description" content="Separate signal from noise. Collect, explore, and export Reddit data for public health research and journalism. No code required.">

  <!-- Favicon -->
  <link rel="icon" type="image/svg+xml" href="/img/favicon.svg">

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,400;0,500;0,600;0,700;1,400&family=IBM+Plex+Mono:wght@400;500&family=IBM+Plex+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">

  <!-- Lucide Icons -->
  <script src="https://unpkg.com/lucide@0.263.1/dist/umd/lucide.min.js"></script>

  <!-- JSZip for exports -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>

  <!-- docx.js for DOCX research report export -->
  <script src="https://cdn.jsdelivr.net/npm/docx@8.5.0/build/index.umd.js"></script>

  <!-- Chart.js for analysis -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

  <!-- Design System -->
  <link rel="stylesheet" href="/css/thresh.css">
</head>
<body>

  <!-- ===== CINEMATIC INTRO ===== -->
  <div id="intro">
    <div id="intro-content">
      <div class="intro-line" data-delay="500">The world is drowning.</div>
      <div class="intro-line intro-dim" data-delay="2500">Every day, millions of voices speak into the void&thinsp;&mdash;</div>
      <div class="intro-line intro-dim" data-delay="4200">their fears, their hopes, their questions.</div>
      <div class="intro-line" data-delay="6500">Most of it is lost.</div>
      <div class="intro-line intro-dim" data-delay="8000">Buried under algorithms. Drowned in the flood.</div>
      <div class="intro-line intro-emphasis" data-delay="10500">But some of it is signal.</div>
      <img src="/img/sigil.svg" class="intro-sigil" data-delay="12500" alt="The Threshing Floor sigil">
      <div class="intro-title" data-delay="14000">The Threshing Floor</div>
      <div class="intro-subtitle" data-delay="15000">Where grain is separated from chaff.</div>
      <button class="intro-enter" data-delay="16000" onclick="window.ThreshApp.enterApp()">Enter the Floor</button>
    </div>
    <button class="intro-skip" onclick="window.ThreshApp.enterApp()">Skip &rarr;</button>
  </div>


  <!-- ===== MAIN APPLICATION ===== -->
  <div id="app" style="display:none">

    <!-- Sidebar Navigation -->
    <nav class="sidebar" aria-label="Main navigation">
      <div class="sidebar-header">
        <button class="sidebar-brand" onclick="ThreshApp.navigate('floor')" aria-label="Go to dashboard">
          <img src="/img/sigil.svg" class="sidebar-sigil" alt="">
          <span class="sidebar-title">The Threshing Floor</span>
        </button>
      </div>
      <ul class="sidebar-nav">
        <li>
          <button class="sidebar-link active" data-page="floor" onclick="ThreshApp.navigate('floor')">
            <svg class="sidebar-icon"><use href="#icon-home"/></svg>
            <span class="sidebar-label">
              <span class="sidebar-label-primary">The Floor</span>
              <span class="sidebar-label-sub">Dashboard</span>
            </span>
          </button>
        </li>
        <li>
          <button class="sidebar-link" data-page="thresh" onclick="ThreshApp.navigate('thresh')">
            <svg class="sidebar-icon"><use href="#icon-wheat"/></svg>
            <span class="sidebar-label">
              <span class="sidebar-label-primary"><span class="sidebar-step">1</span> Thresh</span>
              <span class="sidebar-label-sub">Collect</span>
            </span>
          </button>
        </li>
        <li>
          <button class="sidebar-link" data-page="harvest" onclick="ThreshApp.navigate('harvest')">
            <svg class="sidebar-icon"><use href="#icon-table"/></svg>
            <span class="sidebar-label">
              <span class="sidebar-label-primary"><span class="sidebar-step">2</span> Harvest</span>
              <span class="sidebar-label-sub">Browse</span>
            </span>
          </button>
        </li>
        <li>
          <button class="sidebar-link" data-page="winnow" onclick="ThreshApp.navigate('winnow')">
            <svg class="sidebar-icon"><use href="#icon-sparkles"/></svg>
            <span class="sidebar-label">
              <span class="sidebar-label-primary"><span class="sidebar-step">3</span> Winnow</span>
              <span class="sidebar-label-sub">Analyze</span>
            </span>
          </button>
        </li>
        <li>
          <button class="sidebar-link" data-page="glean" onclick="ThreshApp.navigate('glean')">
            <svg class="sidebar-icon"><use href="#icon-download"/></svg>
            <span class="sidebar-label">
              <span class="sidebar-label-primary"><span class="sidebar-step">4</span> Glean</span>
              <span class="sidebar-label-sub">Export</span>
            </span>
          </button>
        </li>
        <li>
          <button class="sidebar-link" data-page="about" onclick="ThreshApp.navigate('about')">
            <svg class="sidebar-icon"><use href="#icon-info"/></svg>
            <span class="sidebar-label">
              <span class="sidebar-label-primary">About</span>
              <span class="sidebar-label-sub">Ethics &amp; info</span>
            </span>
          </button>
        </li>
      </ul>
      <!-- Rate Limit Sentinel -->
      <div id="rate-sentinel" class="rate-sentinel" title="Reddit allows 100 requests per minute. This gauge shows how many requests remain in the current window. When it runs out, Thresh pauses automatically until the limit resets.">
        <div class="rate-sentinel-label">Rate Limit</div>
        <div class="rate-sentinel-gauge">
          <div id="rate-gauge-fill" class="rate-gauge-fill" style="width:100%"></div>
        </div>
        <div class="rate-sentinel-info">
          <span id="rate-remaining">100</span>/<span>100</span> <span class="text-ash" style="font-size:0.5625rem;">req/min</span>
        </div>
        <div id="rate-blocked-msg" class="rate-blocked-msg" style="display:none">
          <span id="rate-countdown"></span>
        </div>
      </div>

      <div class="sidebar-footer">
        <a href="https://the-companion-dossier.pages.dev/Latent_Dialogic_Space/" target="_blank" rel="noopener" class="text-xs font-mono" style="color:var(--ash);text-decoration:none;" title="Built using Latent Dialogic Space">Built using Latent Dialogic Space</a>
      </div>
    </nav>

    <!-- Mobile Bottom Nav -->
    <nav class="mobile-nav" aria-label="Mobile navigation">
      <button class="mobile-nav-link active" data-page="floor" onclick="ThreshApp.navigate('floor')">
        <i data-lucide="home"></i> Floor
      </button>
      <button class="mobile-nav-link" data-page="thresh" onclick="ThreshApp.navigate('thresh')">
        <i data-lucide="wheat"></i> Thresh
      </button>
      <button class="mobile-nav-link" data-page="harvest" onclick="ThreshApp.navigate('harvest')">
        <i data-lucide="table"></i> Harvest
      </button>
      <button class="mobile-nav-link" data-page="winnow" onclick="ThreshApp.navigate('winnow')">
        <i data-lucide="sparkles"></i> Winnow
      </button>
      <button class="mobile-nav-link" data-page="glean" onclick="ThreshApp.navigate('glean')">
        <i data-lucide="download"></i> Glean
      </button>
      <button class="mobile-nav-link" data-page="about" onclick="ThreshApp.navigate('about')">
        <i data-lucide="info"></i> About
      </button>
    </nav>

    <!-- Main Content -->
    <main class="main-content">

      <!-- ===== THE FLOOR (Dashboard) ===== -->
      <section id="page-floor" class="page-section active">
        <div class="page-header">
          <h1 class="page-title">The Floor</h1>
          <p class="page-subtitle">Your workspace. Begin here.</p>
          <p class="page-epigraph">&ldquo;We are drowning in information, while starving for wisdom.&rdquo;<span class="epigraph-source">&mdash; E.O. Wilson, biologist</span></p>
        </div>

        <!-- What is Thresh? -->
        <div class="card" style="margin-bottom:1.5rem;border-left:3px solid var(--ember);">
          <div class="card-body" style="padding:1rem 1.25rem;">
            <h3 style="font-family:var(--font-display);color:var(--ember);font-size:1.25rem;font-weight:600;margin:0 0 0.5rem 0;">What is Thresh?</h3>
            <p class="text-bone-muted text-sm" style="margin:0 0 0.6rem 0;line-height:1.7;">Every day, millions of people talk to each other on Reddit. They ask for help. They share what scares them. They argue about what matters. Most of it disappears into the scroll.</p>
            <p class="text-bone text-sm" style="margin:0 0 0.6rem 0;line-height:1.7;font-weight:500;">Thresh pulls it out.</p>
            <p class="text-bone-muted text-sm" style="margin:0 0 0.6rem 0;line-height:1.7;">Point it at any subreddit. Tell it what you're looking for. It hands you a clean dataset with a complete record of how it was collected. No accounts, no API keys, no code. Everything runs in your browser. Everything stays on your machine.</p>
            <p class="text-bone-muted text-sm" style="margin:0;line-height:1.7;">The threshing floor is among the oldest inventions in human history. High ground, flat stone, wind. The place where you brought the harvest and beat it until the grain fell free. Every civilization built one. Covenants were sealed on threshing floors. Altars were raised on them. Prophets used them to talk about judgment. They were never passive places. They were where you did the work of separation. The flood is information now, and the grain is what people are actually saying to each other when they think no one important is listening.</p>
          </div>
        </div>

        <div class="card-grid">
          <div class="card">
            <div class="card-header">
              <h3 class="card-title">Quick Start</h3>
            </div>
            <div class="card-body">
              <p class="text-bone-muted" style="margin-bottom: 1rem;">Enter a subreddit name and start collecting data in seconds. No API keys, no code, no setup.</p>
              <button class="btn btn-primary btn-lg" onclick="ThreshApp.navigate('thresh')">
                <i data-lucide="wheat" style="width:18px;height:18px"></i>
                Begin Threshing
              </button>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <h3 class="card-title">How It Works</h3>
            </div>
            <div class="card-body">
              <div style="display:flex;flex-direction:column;gap:0.75rem;">
                <div style="display:flex;align-items:start;gap:0.75rem;">
                  <span class="badge badge-ember" style="min-width:20px;justify-content:center;">1</span>
                  <span class="text-bone-muted text-sm"><strong class="text-bone">Thresh</strong> &mdash; Enter a subreddit and collection parameters</span>
                </div>
                <div style="display:flex;align-items:start;gap:0.75rem;">
                  <span class="badge badge-ember" style="min-width:20px;justify-content:center;">2</span>
                  <span class="text-bone-muted text-sm"><strong class="text-bone">Harvest</strong> &mdash; Browse and search your collected data</span>
                </div>
                <div style="display:flex;align-items:start;gap:0.75rem;">
                  <span class="badge badge-ember" style="min-width:20px;justify-content:center;">3</span>
                  <span class="text-bone-muted text-sm"><strong class="text-bone">Winnow</strong> &mdash; Analyze with word frequency charts and optional AI</span>
                </div>
                <div style="display:flex;align-items:start;gap:0.75rem;">
                  <span class="badge badge-ember" style="min-width:20px;justify-content:center;">4</span>
                  <span class="text-bone-muted text-sm"><strong class="text-bone">Glean</strong> &mdash; Export data with provenance, or generate an AI research report</span>
                </div>
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <h3 class="card-title">Recent Collections</h3>
            </div>
            <div class="card-body" id="floor-recent">
              <p class="text-ash text-sm">No collections yet. Start by threshing a subreddit.</p>
            </div>
          </div>
        </div>

        <!-- Use Cases -->
        <h2 style="font-family:var(--font-display);color:var(--ember);font-size:1.5rem;margin:2.5rem 0 1rem;">Who Uses This &mdash; And How</h2>
        <div class="card-grid">
          <div class="card">
            <div class="card-header">
              <h3 class="card-title">Public Health Researcher</h3>
            </div>
            <div class="card-body">
              <p class="text-bone-muted text-sm" style="margin-bottom:0.75rem;"><em>"What are people in r/mentalhealth talking about this month?"</em></p>
              <div style="display:flex;flex-direction:column;gap:0.5rem;">
                <span class="text-sm"><strong class="text-bone">Thresh:</strong> <span class="text-bone-muted">r/mentalhealth &bull; Top &bull; Past month &bull; 100 posts</span></span>
                <span class="text-sm"><strong class="text-bone">Harvest:</strong> <span class="text-bone-muted">Sort by <code class="font-mono text-ember">score</code> to find what resonates most</span></span>
                <span class="text-sm"><strong class="text-bone">Winnow:</strong> <span class="text-bone-muted">Run <em>Identify themes</em> to map dominant concerns</span></span>
                <span class="text-sm"><strong class="text-bone">Glean:</strong> <span class="text-bone-muted">Export CSV with anonymized usernames for IRB-ready analysis</span></span>
              </div>
              <p class="text-ash text-xs" style="margin-top:0.75rem;"><strong>Strategy tip:</strong> Collect the same subreddit monthly and compare word frequency tables. Emerging terms (e.g., a new medication name, a policy change) show you what&rsquo;s shifting in the conversation before it shows up in the literature.</p>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <h3 class="card-title">Journalist</h3>
            </div>
            <div class="card-body">
              <p class="text-bone-muted text-sm" style="margin-bottom:0.75rem;"><em>"What questions are people asking in r/personalfinance about student loans?"</em></p>
              <div style="display:flex;flex-direction:column;gap:0.5rem;">
                <span class="text-sm"><strong class="text-bone">Thresh:</strong> <span class="text-bone-muted">r/personalfinance &bull; Top &bull; Past week &bull; keyword: "student loans"</span></span>
                <span class="text-sm"><strong class="text-bone">Harvest:</strong> <span class="text-bone-muted">Sort by <code class="font-mono text-ember">num_comments</code> for the biggest conversations</span></span>
                <span class="text-sm"><strong class="text-bone">Winnow:</strong> <span class="text-bone-muted">Run <em>Extract questions</em> to find what people need answered</span></span>
                <span class="text-sm"><strong class="text-bone">Glean:</strong> <span class="text-bone-muted">Provenance.txt gives your editor a transparent methodology section</span></span>
              </div>
              <p class="text-ash text-xs" style="margin-top:0.75rem;"><strong>Strategy tip:</strong> Try the same keyword across different subreddits (r/personalfinance, r/studentloans, r/povertyfinance). The same topic sounds different depending on who&rsquo;s talking &mdash; that contrast is the story.</p>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <h3 class="card-title">Graduate Student</h3>
            </div>
            <div class="card-body">
              <p class="text-bone-muted text-sm" style="margin-bottom:0.75rem;"><em>"I need to compare discourse in r/science vs. r/conspiracy for my thesis."</em></p>
              <div style="display:flex;flex-direction:column;gap:0.5rem;">
                <span class="text-sm"><strong class="text-bone">Thresh:</strong> <span class="text-bone-muted">science, conspiracy &bull; Top &bull; Past year &bull; keyword: "vaccine"</span></span>
                <span class="text-sm"><strong class="text-bone">Harvest:</strong> <span class="text-bone-muted">Compare <code class="font-mono text-ember">upvote_ratio</code> to see consensus vs. division</span></span>
                <span class="text-sm"><strong class="text-bone">Winnow:</strong> <span class="text-bone-muted">Run <em>Sentiment analysis</em> on each, then a <em>Custom prompt</em> comparing tone</span></span>
                <span class="text-sm"><strong class="text-bone">Glean:</strong> <span class="text-bone-muted">Two exports, each with its own provenance &mdash; cite both in your methods section</span></span>
              </div>
              <p class="text-ash text-xs" style="margin-top:0.75rem;"><strong>Strategy tip:</strong> Use the <em>Academic</em> report format on each collection separately, then use a Custom prompt to compare them side by side. You now have a draft comparative analysis with proper methodology documentation for your advisor.</p>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <h3 class="card-title">Community Organizer</h3>
            </div>
            <div class="card-body">
              <p class="text-bone-muted text-sm" style="margin-bottom:0.75rem;"><em>"What are residents saying in our city's subreddit about the new transit plan?"</em></p>
              <div style="display:flex;flex-direction:column;gap:0.5rem;">
                <span class="text-sm"><strong class="text-bone">Thresh:</strong> <span class="text-bone-muted">r/yourcity &bull; New &bull; Past month &bull; keyword: "transit"</span></span>
                <span class="text-sm"><strong class="text-bone">Harvest:</strong> <span class="text-bone-muted">Enable comments to hear the full conversation, not just headlines</span></span>
                <span class="text-sm"><strong class="text-bone">Winnow:</strong> <span class="text-bone-muted">Run <em>Summarize discussion</em> to distill what people actually want</span></span>
                <span class="text-sm"><strong class="text-bone">Glean:</strong> <span class="text-bone-muted">JSON export feeds directly into your own tools or dashboards</span></span>
              </div>
              <p class="text-ash text-xs" style="margin-top:0.75rem;"><strong>Strategy tip:</strong> Collect once with <em>Top</em> sort (what resonates) and once with <em>Controversial</em> sort (what divides). The gap between those two collections is where the real debate lives &mdash; and where a town hall should focus.</p>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <h3 class="card-title">Labor Market Economist</h3>
            </div>
            <div class="card-body">
              <p class="text-bone-muted text-sm" style="margin-bottom:0.75rem;"><em>"What pain points and unmet needs are job seekers describing in r/jobs right now?"</em></p>
              <div style="display:flex;flex-direction:column;gap:0.5rem;">
                <span class="text-sm"><strong class="text-bone">Thresh:</strong> <span class="text-bone-muted">r/jobs &bull; Top &bull; Past month &bull; 100 posts with comments</span></span>
                <span class="text-sm"><strong class="text-bone">Harvest:</strong> <span class="text-bone-muted">Sort by <code class="font-mono text-ember">score</code> to find which frustrations resonate most widely</span></span>
                <span class="text-sm"><strong class="text-bone">Winnow:</strong> <span class="text-bone-muted">Run <em>Identify themes</em> &mdash; salary transparency? ghosting? application fatigue? See what the data says</span></span>
                <span class="text-sm"><strong class="text-bone">Glean:</strong> <span class="text-bone-muted">Generate an AI Research Report framed for your <em>academic</em> audience. You now have a first draft of a labor market sentiment brief grounded in real worker voices</span></span>
              </div>
              <p class="text-ash text-xs" style="margin-top:0.75rem;"><strong>Strategy tip:</strong> Thresh the same subreddit once a month for three months and compare word frequencies over time. That&rsquo;s a longitudinal snapshot of worker sentiment &mdash; impossible to get from BLS data alone.</p>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <h3 class="card-title">Political Campaign Manager</h3>
            </div>
            <div class="card-body">
              <p class="text-bone-muted text-sm" style="margin-bottom:0.75rem;"><em>"What issues are people in r/Denver fired up about before our town hall?"</em></p>
              <div style="display:flex;flex-direction:column;gap:0.5rem;">
                <span class="text-sm"><strong class="text-bone">Thresh:</strong> <span class="text-bone-muted">r/Denver &bull; Hot &bull; Past week &bull; 100 posts with comments</span></span>
                <span class="text-sm"><strong class="text-bone">Harvest:</strong> <span class="text-bone-muted">Sort by <code class="font-mono text-ember">num_comments</code> to find what&rsquo;s sparking the most debate</span></span>
                <span class="text-sm"><strong class="text-bone">Winnow:</strong> <span class="text-bone-muted">Run <em>Extract questions</em> to see what voters are actually asking. Then <em>Identify themes</em> to categorize by issue: housing, crime, transit, cost of living</span></span>
                <span class="text-sm"><strong class="text-bone">Glean:</strong> <span class="text-bone-muted">Generate a <em>Town Hall Brief</em> for your candidate. Export the data as a CSV backup for your comms team</span></span>
              </div>
              <p class="text-ash text-xs" style="margin-top:0.75rem;"><strong>Strategy tip:</strong> Collect from multiple city subreddits (r/Denver, r/DenverFood, r/DenverCirclejerk) to see how the same issues land in different community contexts. Each collection gets its own provenance seal.</p>
            </div>
          </div>
        </div>
      </section>


      <!-- ===== THRESH (Collection) ===== -->
      <section id="page-thresh" class="page-section">
        <div class="page-header">
          <h1 class="page-title">Step 1 &mdash; Thresh</h1>
          <p class="page-subtitle">Configure and collect Reddit data. No API key needed.</p>
          <p class="page-epigraph">&ldquo;Attention is the rarest and purest form of generosity.&rdquo;<span class="epigraph-source">&mdash; Simone Weil, philosopher</span></p>
        </div>

        <div class="card" style="max-width:700px;">
          <form id="thresh-form" onsubmit="return ThreshApp.startCollection(event)">
            <div class="form-group">
              <label class="label" for="subreddit">Subreddit</label>
              <input type="text" id="subreddit" class="input" placeholder="e.g. mentalhealth, publichealth, science" required>
              <p class="form-help">Enter the subreddit name without the r/ prefix. You can enter multiple separated by commas.</p>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label class="label" for="sort">Sort By</label>
                <select id="sort" class="select">
                  <option value="hot">Hot</option>
                  <option value="new">New</option>
                  <option value="top" selected>Top</option>
                  <option value="rising">Rising</option>
                  <option value="controversial">Controversial</option>
                </select>
                <p class="form-help"><strong>Top</strong> = highest-scored posts (best for research). <strong>Hot</strong> = trending now. <strong>New</strong> = most recent. <strong>Rising</strong> = gaining momentum. <strong>Controversial</strong> = most divided (low upvote_ratio).</p>
              </div>
              <div class="form-group">
                <label class="label" for="time-filter">Time Filter</label>
                <select id="time-filter" class="select">
                  <option value="day">Past 24 hours</option>
                  <option value="week" selected>Past week</option>
                  <option value="month">Past month</option>
                  <option value="year">Past year</option>
                  <option value="all">All time</option>
                </select>
                <p class="form-help">Controls which posts are eligible. <strong>Past week</strong> is a good default. Use <strong>Past year</strong> or <strong>All time</strong> for broader studies.</p>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label class="label" for="limit">Max Posts</label>
                <select id="limit" class="select">
                  <option value="10">10</option>
                  <option value="25" selected>25</option>
                  <option value="50">50</option>
                  <option value="100">100</option>
                  <option value="250">250</option>
                  <option value="500">500</option>
                </select>
                <p class="form-help">Posts per subreddit. Start with 25 to preview. 100 is good for focused analysis. 250&ndash;500 collects multiple pages from Reddit (2&ndash;5 requests per subreddit).</p>
              </div>
              <div class="form-group">
                <label class="label" for="keyword">Keyword Filter</label>
                <input type="text" id="keyword" class="input" placeholder="Optional â€” filter post titles">
                <p class="form-help">Searches post titles. Leave empty to collect everything matching your sort/time settings.</p>
              </div>
            </div>

            <div class="form-group">
              <label class="checkbox">
                <input type="checkbox" id="include-comments">
                Include top-level comments (slower &mdash; 1 extra request per post)
              </label>
              <p class="form-help"><strong>What you get:</strong> Up to 50 comments per post, including replies one level deep. Reddit sorts these by "best" by default, so you see the most upvoted responses. Each post costs one additional API request, so 100 posts with comments = ~101 requests. <strong>When to use:</strong> Essential if you want to analyze the conversation (discourse, sentiment, questions). Skip if you only need post titles and bodies.</p>
            </div>

            <hr class="divider">

            <div style="display:flex;gap:0.75rem;align-items:center;">
              <button type="submit" class="btn btn-primary btn-lg" id="thresh-submit">
                <i data-lucide="wheat" style="width:18px;height:18px"></i>
                Thresh
              </button>
              <span id="thresh-status" class="text-sm text-ash"></span>
            </div>
          </form>
        </div>

        <!-- Data Collection Strategy -->
        <div class="card" style="max-width:700px;margin-top:1.5rem;border-left:3px solid var(--ember-dim);">
          <div class="card-body" style="padding:1rem 1.25rem;">
            <h3 style="font-family:var(--font-display);color:var(--ember);font-size:1.1rem;font-weight:600;margin:0 0 0.5rem 0;">Building Bigger Datasets</h3>
            <p class="text-bone-muted text-sm" style="margin:0 0 0.5rem 0;line-height:1.65;">Reddit returns up to 100 posts per request. Thresh automatically paginates for you when you select 250 or 500 posts. But if you need richer data, the real power is <strong>systematic sampling</strong>:</p>
            <div style="display:flex;flex-direction:column;gap:0.4rem;margin-bottom:0.5rem;">
              <span class="text-sm text-bone-muted"><strong class="text-bone">Longitudinal snapshots:</strong> Collect 100 posts from the same subreddit once a week (or once a month) over several weeks. Each collection is timestamped and gets its own provenance record. Compare word frequencies across collections to track how the conversation evolves.</span>
              <span class="text-sm text-bone-muted"><strong class="text-bone">Multi-sort sampling:</strong> Collect the same subreddit with different sort methods. <em>Top</em> gives you what resonated. <em>New</em> gives you what people are saying right now. <em>Controversial</em> gives you what divides the community. Three collections, three lenses on the same data.</span>
              <span class="text-sm text-bone-muted"><strong class="text-bone">Cross-community comparison:</strong> Thresh multiple related subreddits (e.g., r/jobs, r/careeradvice, r/recruitinghell) with the same keyword and time filter. The provenance records make each collection independently citable.</span>
            </div>
            <p class="text-ash text-xs" style="margin:0;line-height:1.5;">Each collection is saved separately in your browser. All exports include full provenance documentation, so every dataset is replicable regardless of when or how you collected it.</p>
          </div>
        </div>

        <!-- Collection Progress -->
        <div id="thresh-progress" style="display:none;margin-top:1.5rem;max-width:700px;">
          <div class="card">
            <div class="card-header">
              <h3 class="card-title">Collecting&hellip;</h3>
              <span id="progress-count" class="badge badge-ember">0 posts</span>
            </div>
            <div class="progress" style="margin-bottom:0.75rem;">
              <div class="progress-fill" id="progress-bar" style="width:0%"></div>
            </div>
            <p id="progress-message" class="text-sm text-bone-muted">Starting collection&hellip;</p>
          </div>
        </div>
      </section>


      <!-- ===== HARVEST (Results) ===== -->
      <section id="page-harvest" class="page-section">
        <div class="page-header">
          <h1 class="page-title">Step 2 &mdash; Harvest</h1>
          <p class="page-subtitle">Browse and explore your collected data.</p>
          <p class="page-epigraph">&ldquo;The eye sees only what the mind is prepared to comprehend.&rdquo;<span class="epigraph-source">&mdash; Robertson Davies, novelist</span></p>
        </div>

        <!-- Collection Selector -->
        <div class="form-group" style="max-width:400px;margin-bottom:1.5rem;">
          <label class="label" for="harvest-collection">Collection</label>
          <select id="harvest-collection" class="select" onchange="ThreshApp.loadCollection(this.value)">
            <option value="">Select a collection&hellip;</option>
          </select>
        </div>

        <!-- Empty state -->
        <div id="harvest-empty" class="empty-state">
          <img src="/img/sigil.svg" class="empty-state-sigil" alt="">
          <h3 class="empty-state-heading">No Data Yet</h3>
          <p class="empty-state-text">Collect some Reddit data first, then come back here to explore it.</p>
          <button class="btn btn-primary" onclick="ThreshApp.navigate('thresh')">Go to Thresh</button>
        </div>

        <!-- Results (hidden until data loaded) -->
        <div id="harvest-results" style="display:none;">
          <!-- Stats bar -->
          <div class="stats-grid" style="margin-bottom:1.5rem;" id="harvest-stats"></div>

          <!-- Data Field Reference (collapsible) -->
          <details class="card" style="margin-bottom:1.5rem;cursor:pointer;">
            <summary style="padding:0.75rem 1rem;font-family:var(--font-body);font-weight:500;color:var(--bone);font-size:0.875rem;list-style:none;display:flex;align-items:center;gap:0.5rem;">
              <i data-lucide="help-circle" style="width:14px;height:14px;color:var(--ember);flex-shrink:0;"></i>
              Understanding Your Data &mdash; What Each Field Means
            </summary>
            <div style="padding:0 1rem 1rem;display:grid;gap:0.5rem;">
              <div class="text-sm"><code class="font-mono text-ember">score</code> <span class="text-bone-muted">&mdash; Net votes (upvotes minus downvotes). High score = community resonance. A post with 500 score was upvoted roughly 500 more times than it was downvoted.</span></div>
              <div class="text-sm"><code class="font-mono text-ember">upvote_ratio</code> <span class="text-bone-muted">&mdash; Fraction of votes that were upvotes (0.0 to 1.0). A ratio of 0.95 means near-unanimous approval. Below 0.60 means the post is divisive &mdash; this is what "Controversial" sort finds.</span></div>
              <div class="text-sm"><code class="font-mono text-ember">num_comments</code> <span class="text-bone-muted">&mdash; Total comments on the post. High comments + low score often means debate. High comments + high score means broad engagement.</span></div>
              <div class="text-sm"><code class="font-mono text-ember">created_utc</code> <span class="text-bone-muted">&mdash; When the post was made (UTC timestamp). Exported as both Unix timestamp and ISO date for your analysis tools.</span></div>
              <div class="text-sm"><code class="font-mono text-ember">is_self</code> <span class="text-bone-muted">&mdash; True if the post is text (a "self-post"). False if it's a link to an external site. Self-posts contain the author's own writing in the <code>selftext</code> field.</span></div>
              <div class="text-sm"><code class="font-mono text-ember">selftext</code> <span class="text-bone-muted">&mdash; The body text of a self-post. This is the primary content for text analysis, sentiment, and theme extraction.</span></div>
              <div class="text-sm"><code class="font-mono text-ember">link_flair_text</code> <span class="text-bone-muted">&mdash; Category label set by subreddit moderators (e.g., "Discussion", "News", "Vent"). Useful for filtering by post type in your analysis.</span></div>
              <div class="text-sm"><code class="font-mono text-ember">author</code> <span class="text-bone-muted">&mdash; Reddit username. Anonymized by default in exports to protect privacy. Shown here for browsing context.</span></div>
              <div class="text-sm"><code class="font-mono text-ember">domain</code> <span class="text-bone-muted">&mdash; Source domain for link posts (e.g., "nytimes.com") or "self.subreddit" for text posts. Useful for tracking which sources a community shares.</span></div>
            </div>
          </details>

          <!-- Search/Filter -->
          <div style="margin-bottom:1rem;display:flex;gap:0.75rem;align-items:center;flex-wrap:wrap;">
            <input type="text" id="harvest-search" class="input" placeholder="Search posts&hellip;" style="max-width:300px;" oninput="ThreshApp.filterHarvest()">
            <span id="harvest-count" class="text-sm text-ash"></span>
          </div>

          <!-- Data Table -->
          <div class="table-wrapper">
            <table class="data-table" id="harvest-table">
              <thead>
                <tr>
                  <th onclick="ThreshApp.sortHarvest('title')">Title</th>
                  <th onclick="ThreshApp.sortHarvest('author')">Author</th>
                  <th onclick="ThreshApp.sortHarvest('score')" style="text-align:right;">Score</th>
                  <th onclick="ThreshApp.sortHarvest('num_comments')" style="text-align:right;">Comments</th>
                  <th onclick="ThreshApp.sortHarvest('created_utc')">Date</th>
                </tr>
              </thead>
              <tbody id="harvest-tbody"></tbody>
            </table>
          </div>

          <!-- Post detail panel -->
          <div id="post-detail" class="card" style="display:none;margin-top:1rem;">
            <div class="card-header">
              <h3 class="card-title" id="detail-title"></h3>
              <button class="btn btn-ghost btn-sm" onclick="document.getElementById('post-detail').style.display='none'">&times; Close</button>
            </div>
            <div id="detail-body" style="margin-bottom:1rem;"></div>
            <div id="detail-comments"></div>
          </div>
        </div>
      </section>


      <!-- ===== GLEAN (Export) ===== -->
      <section id="page-glean" class="page-section">
        <div class="page-header">
          <h1 class="page-title">Step 4 &mdash; Glean</h1>
          <p class="page-subtitle">Export your data with full provenance documentation.</p>
          <p class="page-epigraph">&ldquo;Without data, you're just another person with an opinion.&rdquo;<span class="epigraph-source">&mdash; W. Edwards Deming, statistician</span></p>
        </div>

        <div id="glean-empty" class="empty-state">
          <img src="/img/sigil.svg" class="empty-state-sigil" alt="">
          <h3 class="empty-state-heading">Nothing to Export</h3>
          <p class="empty-state-text">Collect some data first, then return here to export it.</p>
          <button class="btn btn-primary" onclick="ThreshApp.navigate('thresh')">Go to Thresh</button>
        </div>

        <div id="glean-panel" style="display:none;max-width:700px;">
          <div class="card" style="margin-bottom:1.5rem;">
            <div class="form-group">
              <label class="label" for="glean-collection">Collection</label>
              <select id="glean-collection" class="select" onchange="ThreshApp.updateGleanPreview()">
                <option value="">Select a collection&hellip;</option>
              </select>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label class="label" for="export-format">Format</label>
                <select id="export-format" class="select">
                  <option value="csv">CSV (Excel-compatible)</option>
                  <option value="json">JSON</option>
                </select>
                <p class="form-help"><strong>CSV</strong> opens in Excel, Google Sheets, SPSS, and R. <strong>JSON</strong> is better for Python, JavaScript, or feeding into other tools.</p>
              </div>
              <div class="form-group">
                <label class="label">&nbsp;</label>
                <label class="checkbox">
                  <input type="checkbox" id="anonymize-authors" checked>
                  Anonymize usernames
                </label>
                <p class="form-help">Replaces usernames with <code class="font-mono">user_a1b2c3</code> hashes. Recommended for any published or shared work. Your choice is documented in provenance.txt.</p>
              </div>
            </div>

            <hr class="divider">

            <div style="display:flex;gap:0.75rem;">
              <button class="btn btn-primary" onclick="ThreshApp.exportData()">
                <i data-lucide="download" style="width:16px;height:16px"></i>
                Download Export
              </button>
              <button class="btn btn-secondary" onclick="ThreshApp.previewExport()">
                Preview
              </button>
            </div>
          </div>

          <!-- What's in the ZIP -->
          <details class="card" style="margin-bottom:1.5rem;cursor:pointer;">
            <summary style="padding:0.75rem 1rem;font-family:var(--font-body);font-weight:500;color:var(--bone);font-size:0.875rem;list-style:none;display:flex;align-items:center;gap:0.5rem;">
              <i data-lucide="file-archive" style="width:14px;height:14px;color:var(--ember);flex-shrink:0;"></i>
              What's in the Export ZIP?
            </summary>
            <div style="padding:0 1rem 1rem;display:grid;gap:0.5rem;">
              <div class="text-sm"><code class="font-mono text-ember">posts.csv</code> <span class="text-bone-muted">(or .json) &mdash; One row per post. Fields: id, subreddit, title, author, selftext, score, upvote_ratio, num_comments, created_utc, created_date, url, permalink, is_self, flair, domain.</span></div>
              <div class="text-sm"><code class="font-mono text-ember">comments.csv</code> <span class="text-bone-muted">(if collected) &mdash; One row per comment. Fields: id, post_id, author, body, score, created_utc, created_date, depth, parent_id.</span></div>
              <div class="text-sm"><code class="font-mono text-ember">provenance.txt</code> <span class="text-bone-muted">&mdash; Complete methodology record: tool version, subreddit(s), sort method, time filter, keyword, limits, post/comment counts, timestamp, anonymization setting, data source, known limitations, and ethical use guidance. Cite this directly in your methods section.</span></div>
            </div>
          </details>

          <p class="text-bone-muted text-xs" style="margin-bottom:1.5rem;line-height:1.6;padding:0 0.25rem;">Want more than raw data? Scroll down to the <strong class="text-bone">AI Research Report</strong> section to generate a complete Introduction / Methods / Results / Discussion document from your collection. It combines everything: your metadata, statistics, word frequencies, and post content into a structured report you can build on.</p>

          <!-- Preview area -->
          <div id="glean-preview-container" style="display:none;">
            <h4 style="margin-bottom:0.5rem;">Export Preview</h4>
            <div id="glean-preview" class="export-preview"></div>
          </div>

          <hr class="divider divider-ember" style="margin:2rem 0;">

          <!-- AI Research Report Generator -->
          <div class="card" style="margin-bottom:1.5rem;border-left:3px solid var(--ember);">
            <div class="card-header">
              <h3 class="card-title">AI Research Report</h3>
              <span class="badge badge-ember">Powered by Claude Opus</span>
            </div>
            <div class="card-body">
              <p class="text-bone-muted text-sm" style="margin-bottom:1rem;">Generate a complete, downloadable research report from your collection. Claude reads your data, computes patterns, and writes a structured <strong>Introduction / Methods / Results / Discussion</strong> report that you can use as a starting point for your own analysis, a briefing for your editor, or a draft methods section for your thesis.</p>

              <p class="text-bone text-sm" style="margin-bottom:0.5rem;font-weight:600;">How it works:</p>
              <ol style="margin:0 0 1.25rem 0;padding-left:1.25rem;display:flex;flex-direction:column;gap:0.25rem;">
                <li class="text-bone-muted text-sm"><strong class="text-bone">Answer two questions</strong> below so Claude can frame the report around your specific research interest.</li>
                <li class="text-bone-muted text-sm"><strong class="text-bone">Click "Generate Report"</strong> and Claude will aggregate your collection metadata, summary statistics, word frequencies, and post content into a structured report.</li>
                <li class="text-bone-muted text-sm"><strong class="text-bone">Download the result</strong> as a beautifully formatted Word document (.docx) ready for editing, or as Markdown. The report includes full provenance so anyone reading it knows exactly how the data was gathered.</li>
              </ol>

              <div class="form-group">
                <label class="label" for="report-question">What is your research question?</label>
                <textarea id="report-question" class="input" rows="2" placeholder="e.g. What are the dominant concerns expressed by users in r/mentalhealth during the past month?"></textarea>
                <p class="form-help">This frames the Introduction and Discussion. Be as specific as you can. A good research question names the community, the topic, and the timeframe.</p>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label class="label" for="report-audience">Who is this report for?</label>
                  <select id="report-audience" class="select">
                    <option value="academic">Academic &mdash; IMRaD research report</option>
                    <option value="journalism">Journalist &mdash; column / investigative piece</option>
                    <option value="advocacy">Community Organizer &mdash; town hall brief</option>
                    <option value="general">General &mdash; op-ed / explainer</option>
                  </select>
                  <p class="form-help">Each audience gets a different document structure. Academic produces a formal IMRaD paper. Journalist produces a lede-first column. Organizer produces a town hall action brief. General produces a clear op-ed.</p>
                </div>
                <div class="form-group">
                  <label class="label" for="report-context">Brief context (optional)</label>
                  <textarea id="report-context" class="input" rows="2" placeholder="e.g. This is for my MPH capstone project on online health communities."></textarea>
                  <p class="form-help">Anything that helps Claude understand why you collected this data and what you plan to do with the findings.</p>
                </div>
              </div>

              <div style="display:flex;gap:0.75rem;align-items:center;flex-wrap:wrap;">
                <button class="btn btn-primary" onclick="ThreshApp.generateResearchReport()" id="report-generate-btn">
                  <i data-lucide="file-text" style="width:16px;height:16px"></i>
                  Generate Report
                </button>
                <span id="report-status" class="text-sm text-ash"></span>
              </div>
            </div>
          </div>

          <!-- Report Output -->
          <div id="report-result" class="claude-panel" style="display:none;">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:0.5rem;">
              <h3 style="margin:0;font-family:var(--font-display);color:var(--ember);">Research Report</h3>
              <span class="badge badge-ember">AI-Generated</span>
            </div>
            <p class="text-bone-muted text-xs" style="margin-bottom:1rem;">This report was generated by Claude based on your collection data and research question. It is a starting point, not a final product. Review, revise, and build on it.</p>
            <div style="display:flex;gap:0.5rem;margin-bottom:1rem;flex-wrap:wrap;">
              <button class="btn btn-primary btn-sm" onclick="ThreshApp.downloadReportDocx()" title="Download as formatted Word document">
                <i data-lucide="download" style="width:14px;height:14px"></i>
                Download Report (.docx)
              </button>
              <button class="btn btn-ghost btn-sm" onclick="ThreshApp.downloadReport()" title="Download as Markdown file">
                <i data-lucide="file-text" style="width:14px;height:14px"></i>
                Download (.md)
              </button>
              <button class="btn btn-ghost btn-sm" onclick="ThreshApp.copyReport()" title="Copy report text to clipboard">
                <i data-lucide="clipboard-copy" style="width:14px;height:14px"></i>
                Copy to Clipboard
              </button>
            </div>
            <div id="report-response" class="claude-response"></div>
          </div>
        </div>
      </section>


      <!-- ===== WINNOW (AI Analysis) ===== -->
      <section id="page-winnow" class="page-section">
        <div class="page-header">
          <h1 class="page-title">Step 3 &mdash; Winnow</h1>
          <p class="page-subtitle">Separate signal from noise. Start with the built-in word frequency table, then use Claude AI for deeper analysis.</p>
          <p class="page-epigraph">&ldquo;The greatest enemy of knowledge is not ignorance, it is the illusion of knowledge.&rdquo;<span class="epigraph-source">&mdash; Daniel J. Boorstin, historian</span></p>
        </div>

        <div id="winnow-empty" class="empty-state">
          <img src="/img/sigil.svg" class="empty-state-sigil" alt="">
          <h3 class="empty-state-heading">No Data to Analyze Yet</h3>
          <p class="empty-state-text">Head over to <strong>Thresh</strong> to collect posts from a subreddit. Once you have a collection, come back here to explore word patterns and run AI analysis.</p>
          <button class="btn btn-primary" onclick="ThreshApp.navigate('thresh')">Go to Thresh</button>
        </div>

        <div id="winnow-panel" style="display:none;max-width:800px;">

          <!-- Built-in Analysis -->
          <div class="card" style="margin-bottom:1.5rem;border-left:3px solid var(--success);">
            <div class="card-header">
              <h3 class="card-title">Built-in Analysis</h3>
            </div>
            <div class="card-body">
              <p class="text-bone-muted text-sm" style="margin-bottom:0.5rem;">These tools run entirely in your browser at no cost. Select a collection below and they update instantly:</p>
              <div style="display:flex;flex-direction:column;gap:0.5rem;">
                <span class="text-sm"><strong class="text-bone">Post Volume Over Time</strong> <span class="text-bone-muted">&mdash; A bar chart showing how many posts appeared on each day. Spikes mean something triggered a surge of conversation &mdash; a news event, a viral post, a policy change. Flat stretches mean steady background chatter. Gaps mean silence. Look for spikes first, then check what posts appeared on those dates in Harvest.</span></span>
                <span class="text-sm"><strong class="text-bone">Word Frequency Table</strong> <span class="text-bone-muted">&mdash; The top 20 most common words across all post titles and bodies, with stopwords removed. Copyable with one click. This is the literal vocabulary of the conversation &mdash; what people actually say when they talk about this topic.</span></span>
                <span class="text-sm"><strong class="text-bone">Sortable Data Table</strong> <span class="text-bone-muted">&mdash; On the Harvest page, sort by any column. Sort by <code class="font-mono text-ember">score</code> for resonance, <code class="font-mono text-ember">num_comments</code> for engagement, or <code class="font-mono text-ember">date</code> for recency.</span></span>
                <span class="text-sm"><strong class="text-bone">Summary Statistics</strong> <span class="text-bone-muted">&mdash; Post count, average score, average comments, and date range are calculated automatically for every collection.</span></span>
              </div>
            </div>
          </div>

          <!-- Claude AI Analysis -->
          <div class="card" style="margin-bottom:1.5rem;border-left:3px solid var(--ember);">
            <div class="card-header">
              <h3 class="card-title">Claude AI Analysis</h3>
              <span class="badge badge-ember">Powered by Claude Opus</span>
            </div>
            <div class="card-body">
              <p class="text-bone-muted text-sm" style="margin-bottom:0.5rem;">Claude reads your collected posts and produces structured research analysis. It goes beyond counting words &mdash; it understands meaning, groups ideas, and identifies patterns a human analyst would find.</p>
              <div style="display:flex;flex-direction:column;gap:0.5rem;">
                <span class="text-sm"><strong class="text-bone">Identify Themes</strong> <span class="text-bone-muted">&mdash; Groups posts into thematic clusters and names each theme. Perfect for a first pass on unfamiliar data. <em>Example output: "Theme 1: Access to Care (23 posts) &mdash; Users describe long wait times, insurance denials&hellip;"</em></span></span>
                <span class="text-sm"><strong class="text-bone">Sentiment Analysis</strong> <span class="text-bone-muted">&mdash; Classifies overall tone (positive, negative, neutral, mixed) and identifies emotional patterns. Useful for tracking how a community feels about a topic over time.</span></span>
                <span class="text-sm"><strong class="text-bone">Summarize Discussion</strong> <span class="text-bone-muted">&mdash; Produces a structured summary: main points, areas of agreement, areas of disagreement, and standout observations. Good for briefings and literature reviews.</span></span>
                <span class="text-sm"><strong class="text-bone">Extract Questions</strong> <span class="text-bone-muted">&mdash; Pulls out the questions people are asking, categorized by topic. Reveals information gaps and unmet needs &mdash; invaluable for journalists and service providers.</span></span>
                <span class="text-sm"><strong class="text-bone">Custom Prompt</strong> <span class="text-bone-muted">&mdash; Ask Claude anything about your data. Your prompt is combined with a summary of up to 50 posts.</span></span>
              </div>
            </div>
          </div>

          <!-- Step-by-step instructions -->
          <div class="card" style="margin-bottom:1.5rem;border-left:3px solid var(--ember-dim);">
            <div class="card-body">
              <p class="text-bone text-sm" style="margin-bottom:0.5rem;font-weight:600;">How to use this page:</p>
              <ol style="margin:0;padding-left:1.25rem;display:flex;flex-direction:column;gap:0.25rem;">
                <li class="text-bone-muted text-sm"><strong class="text-bone">Pick a collection</strong> from the dropdown below. The chart and word table update immediately.</li>
                <li class="text-bone-muted text-sm"><strong class="text-bone">Read the post volume chart</strong> &mdash; look for spikes (something happened) and gaps (silence). This tells you <em>when</em> the conversation moved.</li>
                <li class="text-bone-muted text-sm"><strong class="text-bone">Scan the word frequency table</strong> &mdash; these are the 20 most common words. This tells you <em>what</em> people are saying. Click "Copy" to grab it.</li>
                <li class="text-bone-muted text-sm"><strong class="text-bone">Run Claude AI analysis</strong> &mdash; choose an analysis type and click "Analyze with Claude." AI analysis is built in and free to use.</li>
                <li class="text-bone-muted text-sm"><strong class="text-bone">Copy or download</strong> the results. Use "Copy to Clipboard" for quick pasting, or "Save as .txt/.md" to keep a file for your records.</li>
              </ol>
            </div>
          </div>

          <div class="card" style="margin-bottom:1.5rem;">
            <div class="form-row">
              <div class="form-group">
                <label class="label" for="winnow-collection">Collection</label>
                <select id="winnow-collection" class="select" onchange="ThreshApp.loadWinnowCollection(this.value)">
                  <option value="">Select a collection&hellip;</option>
                </select>
                <p class="form-help text-xs text-ash" style="margin-top:0.25rem;">Selecting a collection updates the post volume chart and word frequency table below.</p>
              </div>
              <div class="form-group">
                <label class="label" for="winnow-prompt">Analysis Type</label>
                <select id="winnow-prompt" class="select">
                  <option value="themes">Identify key themes &amp; topics</option>
                  <option value="sentiment">Sentiment analysis</option>
                  <option value="summary">Summarize the discussion</option>
                  <option value="questions">Extract questions people are asking</option>
                  <option value="custom">Custom prompt</option>
                </select>
                <p class="form-help text-xs text-ash" style="margin-top:0.25rem;">Powered by Claude Opus 4.6. Select a type and click Analyze.</p>
              </div>
            </div>

            <div class="form-group" id="winnow-custom-group" style="display:none;">
              <label class="label" for="winnow-custom">Custom Prompt</label>
              <textarea id="winnow-custom" class="input" rows="3" placeholder="What would you like Claude to analyze?"></textarea>
              <p class="form-help" style="margin-top:0.5rem;">Example prompts you can try:</p>
              <div style="display:flex;flex-direction:column;gap:0.25rem;margin-top:0.25rem;">
                <span class="text-xs text-bone-muted font-mono">"What misconceptions appear most frequently in these posts?"</span>
                <span class="text-xs text-bone-muted font-mono">"Identify posts that describe personal experiences vs. those sharing news articles."</span>
                <span class="text-xs text-bone-muted font-mono">"What specific policy changes are people advocating for?"</span>
                <span class="text-xs text-bone-muted font-mono">"Compare the tone of high-score vs. low-score posts."</span>
              </div>
            </div>

            <div style="display:flex;gap:0.75rem;align-items:center;flex-wrap:wrap;">
              <button class="btn btn-primary" onclick="ThreshApp.runAnalysis()">
                <i data-lucide="sparkles" style="width:16px;height:16px"></i>
                Analyze with Claude
              </button>
              <span id="winnow-status" class="text-sm text-ash"></span>
            </div>
          </div>

          <!-- Post Volume Over Time Chart -->
          <div class="card" style="margin-bottom:1.5rem;">
            <div class="card-header">
              <h3 class="card-title">Post Volume Over Time</h3>
              <span class="text-xs text-ash">Runs in your browser &mdash; no AI needed</span>
            </div>
            <p class="text-bone-muted text-xs" style="padding:0 1rem 0.5rem;">Shows how many posts were created on each day in your collection. Spikes reveal when a topic surged &mdash; a news event, a viral post, or a policy announcement. Flat lines mean steady background conversation. Gaps mean the community went quiet. Use this alongside word frequency to see not just <em>what</em> people are saying but <em>when</em> they started saying it.</p>
            <div id="temporal-chart-wrap" style="padding:0.5rem 1rem 1rem;position:relative;height:220px;">
              <p class="text-ash text-sm" style="text-align:center;padding:2rem 0;">Select a collection above to see posting patterns.</p>
            </div>
          </div>

          <!-- Word Frequency Table (client-side, no API needed) -->
          <div class="card" style="margin-bottom:1.5rem;">
            <div class="card-header" style="display:flex;justify-content:space-between;align-items:center;">
              <div>
                <h3 class="card-title">Word Frequency</h3>
                <span class="text-xs text-ash">Instant, runs in your browser</span>
              </div>
              <button id="word-freq-copy" class="btn btn-ghost btn-sm" onclick="ThreshApp.copyWordFreq()" title="Copy table to clipboard" style="display:none;">
                <i data-lucide="clipboard-copy" style="width:14px;height:14px"></i>
                Copy
              </button>
            </div>
            <p class="text-bone-muted text-xs" style="padding:0 1rem 0.5rem;">Top 20 words from all post titles and bodies, with common stopwords removed. This is the literal vocabulary of the conversation &mdash; the words people actually use when talking about this topic.</p>
            <div id="word-freq-table-wrap" style="padding:0 1rem 1rem;">
              <p class="text-ash text-sm" style="text-align:center;padding:2rem 0;">Select a collection above to see word frequencies.</p>
            </div>
          </div>

          <!-- Claude Analysis Result -->
          <div id="winnow-result" class="claude-panel" style="display:none;">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:0.5rem;">
              <h3 style="margin:0;font-family:var(--font-display);color:var(--ember);">Claude's Analysis</h3>
              <div style="display:flex;gap:0.5rem;align-items:center;">
                <span class="badge badge-ember">AI-Generated</span>
              </div>
            </div>
            <p class="text-bone-muted text-xs" style="margin-bottom:1rem;">This analysis was generated by Claude based on the posts in your collection. You can copy the full text or download it as a file to include in your research.</p>
            <div style="display:flex;gap:0.5rem;margin-bottom:1rem;">
              <button class="btn btn-ghost btn-sm" onclick="ThreshApp.copyAnalysis()" title="Copy analysis text to clipboard">
                <i data-lucide="clipboard-copy" style="width:14px;height:14px"></i>
                Copy to Clipboard
              </button>
              <button class="btn btn-ghost btn-sm" onclick="ThreshApp.downloadAnalysis('txt')" title="Download as plain text file">
                <i data-lucide="file-text" style="width:14px;height:14px"></i>
                Save as .txt
              </button>
              <button class="btn btn-ghost btn-sm" onclick="ThreshApp.downloadAnalysis('md')" title="Download as Markdown file">
                <i data-lucide="file-down" style="width:14px;height:14px"></i>
                Save as .md
              </button>
            </div>
            <div id="winnow-response" class="claude-response"></div>
          </div>
        </div>
      </section>


      <!-- ===== ABOUT ===== -->
      <section id="page-about" class="page-section">
        <div class="page-header">
          <h1 class="page-title">About</h1>
          <p class="page-subtitle">Ethics, methodology, and how this tool works.</p>
          <p class="page-epigraph">&ldquo;Science is a way of thinking much more than it is a body of knowledge.&rdquo;<span class="epigraph-source">&mdash; Carl Sagan, astronomer</span></p>
        </div>

        <div style="max-width:700px;">

          <!-- A Letter from the Builder -->
          <div class="about-section" style="padding:1.5rem;background:var(--surface);border:1px solid rgba(201,162,39,0.15);border-radius:var(--radius-md);margin-bottom:2.5rem;">
            <h3 style="font-family:var(--font-display);font-size:1.375rem;color:var(--ember);margin-bottom:1rem;">A Letter from the Builder</h3>
            <div style="font-family:var(--font-body);font-size:0.9375rem;color:var(--bone-muted);line-height:1.8;">
              <p>I built this because I know what it feels like to drown.</p>
              <p>Not in water. In data.</p>
              <p>I spent years writing a dissertation on social media discourse during the COVID-19 pandemic. Collecting tweets. Analyzing what people were saying to each other while the world fell apart. And what I found was genuinely illuminating. The patterns were there. The fear, the misinformation, the solidarity, the grief, the stubborn and sometimes beautiful ways people tried to make sense of something that didn't make sense. It was some of the most meaningful work I've ever done.</p>
              <p>But the process of getting there was brutal. Even for me. Even with training and tools and institutional support. It required programming. It required API credentials. It required understanding rate limits and data schemas and pagination logic and a dozen other things that had nothing to do with the actual research question I was trying to answer.</p>
              <p>And I kept thinking: if this is this hard for me, it is impossible for most people. The teachers who sense something shifting in how their students talk about mental health online. The journalists who can feel a story forming in a subreddit but can't prove it yet. The community organizers. The grad students. They're locked out. Not because they lack the curiosity or the intellect, but because the tools weren't built for them.</p>
              <p>So I built this.</p>
              <p>It can do much of what my dissertation did. Smaller scale, because of Reddit's rate limits. But that's fine. Small is good, if pointed in the right place, focused with the right lens. A hundred posts from the right subreddit in the right week will tell you more about how a community thinks than a thousand posts scraped without intention.</p>
              <p>The world right now is full of quantitative social science. AI has made it easy to count things, to run regressions, to produce charts at speed. I'm grateful for that. But this project aims at something different. It aims at breathing life back into a research method I hold dear: qualitative inquiry. The close reading. The careful listening. Not because I'm an expert in it. Exactly the opposite, really. I chose the quantitative path early in my training, and I have admired qualitative work from afar ever since, with the quiet reverence of someone who knows they took the other road. There is something mysterious in it. Something irreducible. The act of sitting with people's words and asking <em>what do they mean</em> rather than <em>how many are there</em>.</p>
              <p>At the deepest core, my hope is that Thresh marries the two again. That it gives you the structure to collect carefully, the numbers to orient yourself, and then the space to read. Really read. What people are saying. That it empowers anyone interested in understanding public discourse to gather data more easily, more ethically, and more transparently than the old tools ever allowed.</p>
              <p>The ultimate recursion is this: what was once my dissertation is now everybody's tool.</p>
              <p>The waters rise. The feed is a flood. But the threshing floor is high ground, and the work of separation is ancient, and the grain is worth the labor.</p>
              <p style="margin-bottom:0.25rem;">With hope,</p>
              <p style="color:var(--ember);font-family:var(--font-display);font-size:1.0625rem;font-weight:600;margin-bottom:0.125rem;">Jacob E. Thomas, MA, PhD</p>
              <p style="font-size:0.8125rem;color:var(--ash);margin:0;">February 2026</p>
            </div>
          </div>

          <div class="about-section">
            <h3>What Is This?</h3>
            <p>The Threshing Floor is a free, open-source tool for collecting and exporting Reddit data. It is designed for public health researchers, journalists, civic technologists, and anyone who believes public discourse is worth measuring.</p>
            <p>It runs entirely in your browser. There is no server, no database, no account to create. Your data stays on your machine.</p>
          </div>

          <div class="about-section">
            <h3>How It Works</h3>
            <p>Reddit's public pages serve JSON data alongside HTML. The Threshing Floor fetches this public data through a lightweight proxy (to handle browser security restrictions), then lets you browse, filter, and export it.</p>
            <p>No Reddit API key is required. No authentication of any kind. The data collected is limited to what any person could see by visiting Reddit in a web browser.</p>
            <p>The workflow follows four steps. Each one builds on the last:</p>
            <ol>
              <li><strong>Thresh</strong> (Collect) &mdash; Enter a subreddit, choose your sort method and time filter, set a post limit, and optionally filter by keyword. Click Thresh. The tool gathers posts (and optionally comments) and stores them in your browser.</li>
              <li><strong>Harvest</strong> (Browse) &mdash; Explore your collected data in a sortable, searchable table. Click any post to read its full text and comments. Sort by score to see what resonates, by comments to see what sparks debate, or by date to follow the conversation over time.</li>
              <li><strong>Winnow</strong> (Analyze) &mdash; Start with the built-in word frequency table, then use Claude AI to identify themes, extract sentiment, summarize discussions, or ask custom questions about your data. AI analysis is built in and free to use.</li>
              <li><strong>Glean</strong> (Export) &mdash; Download your data as CSV or JSON, bundled in a ZIP with a provenance.txt file that documents exactly how it was collected. Or generate an <strong>AI Report</strong>: answer two questions about your research, choose your audience, and Claude produces a document tailored to your needs &mdash; an IMRaD paper for academics, a data-driven column for journalists, a town hall brief for organizers, or an op-ed for general audiences.</li>
            </ol>
          </div>

          <div class="about-section">
            <h3>The AI Report Generator</h3>
            <p>The Glean page includes an <strong>AI Report Generator</strong> powered by Claude Opus 4.6, Anthropic's most capable model. You provide a research question, choose your audience, and optionally add context. Claude aggregates your collection metadata, summary statistics, word frequency analysis, and the content of up to 50 posts into a complete document.</p>
            <p>Each audience gets a different document format:</p>
            <ul>
              <li><strong>Academic</strong> &mdash; Formal IMRaD paper (Introduction, Methods, Results, Discussion). Hedged language, rigorous limitations, replication-ready methodology. For theses, journal submissions, and IRB documentation.</li>
              <li><strong>Journalist</strong> &mdash; A data-driven column. Lede-first structure, compelling narrative, quotes from the data, and a methods note for transparency. For newsroom briefings and story pitches.</li>
              <li><strong>Community Organizer</strong> &mdash; A town hall brief. Key findings as talking points, community voices highlighted, recommended actions, and a statistical snapshot. For city council meetings, campaign prep, and advocacy reports.</li>
              <li><strong>General</strong> &mdash; An op-ed or explainer piece. Curious tone, narrative arc, accessible statistics, honest caveats. For personal research, newsletters, and public writing.</li>
            </ul>
            <p>The report downloads as a <strong>formatted Word document (.docx)</strong> ready for editing in Microsoft Word or Google Docs. Markdown and clipboard copy are also available.</p>
            <p>What was once a dissertation-level undertaking now takes ten minutes and a good question.</p>
          </div>

          <div class="about-section">
            <h3>Your Data &amp; Storage</h3>
            <p><strong>Everything is stored in your browser only.</strong> There is no server database, no account system, and no cloud sync. Specifically:</p>
            <ul>
              <li><strong>Collections</strong> (posts, comments, configuration) are saved in your browser's <code>localStorage</code>.</li>
              <li><strong>Rate limit state</strong> and <strong>subreddit cache</strong> are also stored locally in your browser.</li>
            </ul>
            <p>AI analysis is powered by Claude Opus 4.6 via a secure managed proxy. No API keys are required or stored on your device.</p>
            <p>This means your data does not sync across browsers or devices. If you switch browsers, your collections will not follow.</p>
          </div>

          <div class="about-section">
            <h3>Clearing Your History</h3>
            <p>To erase all Thresh data from your browser:</p>
            <ol>
              <li>Open your browser's <strong>Settings</strong> (or press <code>Ctrl+Shift+Delete</code> / <code>Cmd+Shift+Delete</code>)</li>
              <li>Navigate to <strong>Privacy &amp; Security</strong> &rarr; <strong>Clear browsing data</strong></li>
              <li>Select <strong>"Cookies and site data"</strong> (this includes localStorage)</li>
              <li>To clear only Thresh: go to your browser's <strong>Developer Tools</strong> (<code>F12</code>), open the <strong>Application</strong> tab, expand <strong>Local Storage</strong>, find the Thresh site, and delete individual keys or click <strong>Clear All</strong></li>
            </ol>
            <p>This will remove all saved collections, rate limit state, and cached subreddit data. It cannot be undone.</p>
          </div>

          <div class="about-section">
            <h3>The Rate Limit Gauge</h3>
            <p>The <strong>Rate Limit</strong> gauge at the bottom of the sidebar tracks how many requests remain in your current Reddit rate limit window. Reddit allows <strong>100 requests per minute</strong> to its public JSON endpoints.</p>
            <ul>
              <li><strong>Gold bar</strong> &mdash; plenty of requests remaining. Normal operation.</li>
              <li><strong>Yellow bar (below 30%)</strong> &mdash; requests are running low. Consider pausing collection.</li>
              <li><strong>Red pulsing bar (below 10%)</strong> &mdash; critical. Thresh will pause automatically if the limit is reached.</li>
              <li><strong>Cooldown timer</strong> &mdash; if you hit the limit, a countdown appears showing when requests resume. The collect button is disabled until the cooldown expires.</li>
            </ul>
            <p>The rate limit resets automatically each minute. Under normal use (25&ndash;100 posts per collection), you will rarely see it drop below gold.</p>
          </div>

          <div class="about-section">
            <h3>Ethical Considerations</h3>
            <ul>
              <li><strong>Re-identification risk:</strong> Even with usernames removed, unique writing styles or specific details in posts may allow re-identification. Consider this when publishing findings.</li>
              <li><strong>IRB guidance:</strong> If you are conducting academic research, consult your Institutional Review Board about whether your data collection constitutes human subjects research.</li>
              <li><strong>Reddit's Terms:</strong> This tool accesses publicly available data. Please review Reddit's Terms of Service and API Terms regarding data collection and use.</li>
              <li><strong>Consent:</strong> Reddit users post publicly, but they may not expect their posts to be aggregated and analyzed. Handle data with care and respect.</li>
              <li><strong>Default anonymization:</strong> Exports anonymize usernames by default. You can disable this, but consider the implications before doing so.</li>
            </ul>
          </div>

          <div class="about-section">
            <h3>Provenance</h3>
            <p>Every export includes a <code>provenance.txt</code> file documenting exactly how the data was collected: the subreddit, sort method, time filter, number of posts, date of collection, and any filters applied. This is the seal on every bundle &mdash; it gives you the language for a methods section, a transparency report, or a replication attempt.</p>
          </div>

          <div class="about-section">
            <h3>AI Analysis</h3>
            <p>Thresh uses <strong>Claude Opus 4.6</strong> (by Anthropic), the most capable AI model available, for analysis and research report generation. AI features are built in and free to use &mdash; no API key needed.</p>
            <p>AI requests are routed through a secure managed proxy at <code>api.the-threshing-floor.com</code>. The API key is stored server-side as an encrypted secret. Your data is sent to Anthropic for analysis and is not logged or stored by the proxy.</p>
          </div>

          <div class="about-section">
            <h3>Open Source</h3>
            <p>The Threshing Floor is free and open source. The code is available on <a href="https://github.com/jethomasphd/The_Threshing_Floor" target="_blank" rel="noopener">GitHub</a>.</p>
          </div>

          <div class="about-section">
            <h3>Get in Touch</h3>
            <p>Found a bug? Have a feature request? Want to share how you&rsquo;re using Thresh?</p>
            <ul>
              <li><strong>Email:</strong> <a href="mailto:JEThomasPhD@gmail.com" style="color:var(--link);">JEThomasPhD@gmail.com</a></li>
              <li><strong>Bug reports &amp; feature requests:</strong> <a href="https://github.com/jethomasphd/The_Threshing_Floor/issues" target="_blank" rel="noopener" style="color:var(--link);">Open an issue on GitHub</a></li>
              <li><strong>Contributions:</strong> Pull requests are welcome. See the <a href="https://github.com/jethomasphd/The_Threshing_Floor" target="_blank" rel="noopener" style="color:var(--link);">repository</a> for details.</li>
            </ul>
          </div>

          <div class="about-section">
            <h3>Citation</h3>
            <p class="font-mono text-sm" style="background:var(--surface-raised);padding:1rem;border-radius:var(--radius-sm);">Thomas, J.E. (2026). The Threshing Floor: A browser-based tool for Reddit data collection and export. https://github.com/jethomasphd/The_Threshing_Floor</p>
          </div>

          <div class="about-section" style="margin-top:2rem;padding-top:1.5rem;border-top:1px solid rgba(201,162,39,0.12);">
            <p class="text-ash text-sm" style="text-align:center;">Built using <a href="https://the-companion-dossier.pages.dev/Latent_Dialogic_Space/" target="_blank" rel="noopener" style="color:var(--ember-dim);text-decoration:underline;">Latent Dialogic Space</a></p>
          </div>
        </div>
      </section>

    </main>
  </div>

  <!-- Toast Container -->
  <div class="toast-container" id="toast-container"></div>

  <!-- Inline SVG Icons (referenced by sidebar) -->
  <svg style="display:none">
    <symbol id="icon-home" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></symbol>
    <symbol id="icon-wheat" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 22 16 8"/><path d="M3.47 12.53 5 11l1.53 1.53a3.5 3.5 0 0 1 0 4.94L5 19l-1.53-1.53a3.5 3.5 0 0 1 0-4.94Z"/><path d="M7.47 8.53 9 7l1.53 1.53a3.5 3.5 0 0 1 0 4.94L9 15l-1.53-1.53a3.5 3.5 0 0 1 0-4.94Z"/><path d="M11.47 4.53 13 3l1.53 1.53a3.5 3.5 0 0 1 0 4.94L13 11l-1.53-1.53a3.5 3.5 0 0 1 0-4.94Z"/><path d="M20 2h2v2a4 4 0 0 1-4 4h-2V6a4 4 0 0 1 4-4Z"/><path d="M11.47 17.47 13 19l-1.53 1.53a3.5 3.5 0 0 1-4.94 0L5 19l1.53-1.53a3.5 3.5 0 0 1 4.94 0Z"/><path d="M15.47 13.47 17 15l-1.53 1.53a3.5 3.5 0 0 1-4.94 0L9 15l1.53-1.53a3.5 3.5 0 0 1 4.94 0Z"/><path d="M19.47 9.47 21 11l-1.53 1.53a3.5 3.5 0 0 1-4.94 0L13 11l1.53-1.53a3.5 3.5 0 0 1 4.94 0Z"/></symbol>
    <symbol id="icon-table" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="18" height="18" x="3" y="3" rx="2" ry="2"/><line x1="3" x2="21" y1="9" y2="9"/><line x1="3" x2="21" y1="15" y2="15"/><line x1="9" x2="9" y1="3" y2="21"/></symbol>
    <symbol id="icon-download" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></symbol>
    <symbol id="icon-sparkles" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/><path d="M5 3v4"/><path d="M19 17v4"/><path d="M3 5h4"/><path d="M17 19h4"/></symbol>
    <symbol id="icon-info" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></symbol>
  </svg>

  <!-- Application JavaScript -->
  <script src="/js/reddit.js"></script>
  <script src="/js/exporter.js"></script>
  <script src="/js/claude.js"></script>
  <script src="/js/app.js"></script>
</body>
</html>
