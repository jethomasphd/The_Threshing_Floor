<!-- Subreddit detail panel — swapped into #subreddit-detail by HTMX -->
<div class="card" id="detail-panel">
  <!-- Detail header -->
  <div class="card-header">
    <div class="flex items-center gap-3">
      <i data-lucide="compass" class="w-5 h-5 text-ember"></i>
      <h2 class="card-title">
        r/{{ subreddit.name }}
      </h2>
    </div>
    <button class="btn btn-ghost btn-sm"
            onclick="document.getElementById('subreddit-detail').innerHTML = ''"
            title="Close detail panel">
      <i data-lucide="x" class="w-4 h-4"></i>
    </button>
  </div>

  <!-- Subreddit metadata -->
  <div class="card-body">
    {% if subreddit.title %}
    <p class="text-bone mb-3" style="font-size: 1.0625rem;">{{ subreddit.title }}</p>
    {% endif %}

    {% if subreddit.description %}
    <p class="text-bone-muted text-sm mb-4" style="line-height: 1.6;">{{ subreddit.description }}</p>
    {% endif %}

    <!-- Stats row -->
    <div class="flex flex-wrap gap-6 mb-5 pb-4" style="border-bottom: 1px solid var(--smoke);">
      <div class="stat">
        <span class="stat-value" style="font-size: 1.5rem;">{{ format_subscribers(subreddit.subscribers) }}</span>
        <span class="stat-label">Subscribers</span>
      </div>
      {% if subreddit.created_utc %}
      <div class="stat">
        <span class="stat-value" style="font-size: 1.5rem;">{{ format_timestamp(subreddit.created_utc) }}</span>
        <span class="stat-label">Created</span>
      </div>
      {% endif %}
    </div>

    <!-- Action buttons -->
    <div class="flex flex-wrap gap-3 mb-5">
      <a href="/thresh?subreddit={{ subreddit.name }}" class="btn btn-primary">
        <i data-lucide="wheat" class="w-4 h-4"></i>
        Collect from r/{{ subreddit.name }}
      </a>
      <a href="https://www.reddit.com/r/{{ subreddit.name }}/"
         target="_blank"
         rel="noopener noreferrer"
         class="btn btn-secondary">
        <i data-lucide="external-link" class="w-4 h-4"></i>
        View on Reddit
      </a>
    </div>

    <!-- Post preview section -->
    <div style="border-top: 1px solid rgba(201, 162, 39, 0.12); padding-top: 1.25rem;">
      <div class="flex items-center justify-between mb-4">
        <h3 class="font-display text-lg text-bone font-semibold">Recent Posts</h3>
        <div class="flex gap-2">
          <button class="btn btn-ghost btn-sm post-sort-btn active"
                  hx-get="/api/subreddits/{{ subreddit.name }}/posts?sort=hot&limit=10"
                  hx-target="#posts-preview"
                  hx-swap="innerHTML"
                  hx-indicator="#posts-loading">
            Hot
          </button>
          <button class="btn btn-ghost btn-sm post-sort-btn"
                  hx-get="/api/subreddits/{{ subreddit.name }}/posts?sort=new&limit=10"
                  hx-target="#posts-preview"
                  hx-swap="innerHTML"
                  hx-indicator="#posts-loading">
            New
          </button>
          <button class="btn btn-ghost btn-sm post-sort-btn"
                  hx-get="/api/subreddits/{{ subreddit.name }}/posts?sort=top&time_filter=week&limit=10"
                  hx-target="#posts-preview"
                  hx-swap="innerHTML"
                  hx-indicator="#posts-loading">
            Top (Week)
          </button>
        </div>
      </div>

      <!-- Posts loading indicator -->
      <div id="posts-loading" class="htmx-indicator">
        <div class="loading-state" style="padding: 1.5rem;">
          <img src="/static/img/sigil.svg" alt="Loading..." class="loading-sigil" style="width: 32px; height: 32px;">
          <p class="loading-text">Loading posts...</p>
        </div>
      </div>

      <!-- Posts container — auto-loads hot posts on render -->
      <div id="posts-preview"
           hx-get="/api/subreddits/{{ subreddit.name }}/posts?sort=hot&limit=10"
           hx-trigger="load"
           hx-swap="innerHTML"
           hx-indicator="#posts-loading">
      </div>
    </div>
  </div>
</div>

<!-- Scroll the detail panel into view -->
<script>
  document.getElementById('detail-panel').scrollIntoView({ behavior: 'smooth', block: 'start' });
</script>
